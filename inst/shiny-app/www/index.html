<!DOCTYPE html>
<html>

<head>
    <script src="shared/jquery.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="shared/shiny.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body class="p-0">
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
        <symbol id="check-circle-fill" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
        </symbol>
        <symbol id="info-fill" viewBox="0 0 16 16">
            <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
        </symbol>
        <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16">
            <path
                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
        </symbol>
    </svg>
    <nav class="navbar navbar-expand-lg bg-body-tertiary" id="mainNav">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="scm_logo.png" alt="" height="40" style="margin: -5px 0;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <button type="button" class="btn btn-light" data-bs-toggle="modal"
                        data-bs-target="#usageModal">Usage</button>
                </ul>
                <div class="d-flex">
                    <button class="btn btn-outline-primary me-2" type="button" id="outputButton">Output
                        Parameters</button>
                    <button class="btn btn-outline-secondary" type="button" id="resetButton">Reset</button>
                </div>
            </div>
        </div>
    </nav>
    <section id="options" class="container-xl mt-3">
        <ul class="nav nav-pills" id="mainTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#pane-home"
                    type="button" role="tab">
                    Cells and Genes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="atac-tab" data-bs-toggle="tab" data-bs-target="#pane-atac" type="button"
                    role="tab">
                    Chromatin Accessibility
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sim-tab" data-bs-toggle="tab" data-bs-target="#pane-sim" type="button"
                    role="tab">
                    Simulation Settings
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="spatial-tab" data-bs-toggle="tab" data-bs-target="#pane-spatial"
                    type="button" role="tab">
                    Spatial Data
                </button>
            </li>
            <li class="nav-item d-none" role="presentation">
                <button class="nav-link" id="recipe-tab" data-bs-toggle="tab" data-bs-target="#pane-recipes"
                    type="button" role="tab">
                    Recipes
                </button>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div class="tab-pane active pt-2" id="pane-home" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                <div class="accordion my-2" id="accordionCIFHelp">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseCIFHelp">
                                Summary: Cell Identity Factors (CIF) and Gene Identity Vectors (GIV)
                            </button>
                        </h2>
                        <div id="collapseCIFHelp" class="accordion-collapse collapse show"
                            data-bs-parent="#accordionCIFHelp">
                            <div class="accordion-body" style="height: 240px">
                                <div id="cif-svg-container" class="mx-auto" style="width: 960px"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Identity Factors</div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <h6 class="mb-2">Cell Identity Factors (CIF)</h6>
                                        <div class="input-group">
                                            <span class="input-group-text">Num. CIF</span>
                                            <input name="num.cifs" type="number" class="form-control" placeholder="50"
                                                value="50" data-v="i:10-1000" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2">
                                            Length of the Cell Identity Factors (CIF) vector, which can be considered as
                                            a latent representation of a cell's
                                            state and identity. The Gene Identity Vector (GIV) for each gene will also
                                            be the same length.
                                        </div>
                                        <div class="input-group">
                                            <span class="input-group-text">diff-CIF Proportion</span>
                                            <input name="diff.cif.fraction" type="number" class="form-control"
                                                placeholder="0.9" value="0.9" data-v="f:0-1">
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2">
                                            A CIF vector is divided into diff and non-diff-CIF. diff-CIF encodes cell
                                            type information, while non-diff-CIF
                                            encodes inherent cell heterogenity (i.e. randomly sampled). The more
                                            diff-CIF you have, the cell types (clusters or
                                            trajectories) will be more prominent in the result.
                                        </div>
                                    </div>
                                    <div class="col">
                                        <h6 class="mb-2">
                                            <span class="legend-rect" style="background: rgb(207, 226, 255)"></span>
                                            non-diff-CIF Distribution
                                        </h6>
                                        <div class="input-group">
                                            <span class="input-group-text">μ</span>
                                            <input name="cif.center" type="number" class="form-control" placeholder="1"
                                                value="1" data-v="f:0-1000" />
                                            <span class="input-group-text">σ</span>
                                            <input name="cif.sigma" type="number" class="form-control" placeholder="0.1"
                                                value="0.1" data-v="f:0-1000" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small px-2 py-2">
                                            The values in non-diff-CIF will be sampled from the Gaussian distribution
                                            N(μ,σ).
                                        </div>
                                        <h6 class="mt-3 mb-2">
                                            <span class="legend-rect" style="background: rgb(226, 217, 255)"></span>
                                            Gene Identity Vectors (GIV) Distribution
                                        </h6>
                                        <div class="input-group">
                                            <span class="input-group-text">μ</span>
                                            <input name="giv.mean" type="number" class="form-control" placeholder="0"
                                                value="0" data-v="f:0-1000" />
                                            <span class="input-group-text">σ</span>
                                            <input name="giv.sd" type="number" class="form-control" placeholder="1"
                                                value="1" data-v="f:0-1000" />
                                            <span class="input-group-text">p</span>
                                            <input name="giv.prob" type="number" class="form-control" placeholder="0.3"
                                                value="0.3" data-v="f:0-1" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small px-2 pt-2">
                                            The values in GIV will be sampled from this distribution: With prob. p, the
                                            value is zero; with prob. 1-p, the value
                                            is sampled from a Gaussian distribution N(μ,σ).
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Cell Population</div>
                            <div class="card-body">
                                <div class="input-group mb-2">
                                    <span class="input-group-text">Num. Cells</span>
                                    <input name="num.cells" type="number" class="form-control" placeholder="500"
                                        value="500" data-v="i:1-10000000" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <!-- Population Type -->
                                <ul class="nav nav-pills" id="cellPopTab" role="tablist" style="display: none">
                                    <button class="nav-link active" id="pop-cont-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-pop-cont" type="button" role="tab">
                                        Continuous
                                    </button>
                                    <button class="nav-link" id="pop-disc-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-pop-disc" type="button" role="tab">
                                        Discrete
                                    </button>
                                </ul>
                                <div class="input-group mt-2">
                                    <span class="input-group-text">Population Type</span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="_cellPop" value="continuous"
                                            id="cellPopContinuous" checked />
                                        <label class="form-check-label ms-1" for="cellPopContinuous"> Continuous
                                        </label>
                                    </span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="_cellPop" value="discrete"
                                            id="cellPopDiscrete" />
                                        <label class="form-check-label ms-1" for="cellPopDiscrete"> Discrete </label>
                                    </span>
                                </div>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="pane-pop-cont" role="tabpanel" tabindex="0">
                                        <div class="text-secondary text-small p-2">
                                            For continuous population, the cells will be sampled along the cell
                                            differentiation tree.
                                        </div>
                                        <div class="border rounded p-2">
                                            <div class="mb-1">
                                                <span class="legend-rect" style="background: rgb(209, 231, 221)"></span>
                                                Cell Differentiation Tree
                                            </div>
                                            <div class="text-secondary text-small mb-2">
                                                Specify the differentiation relationship between cell types. scMultiSim
                                                provides three pre-defined trees: Phyla1,
                                                Phyla3, and Phyla5, or you may input the expression of an R phylo tree
                                                object.
                                            </div>
                                            <div class="row row-cols-3 my-2">
                                                <div class="col">
                                                    <img src="phyla5.png" height="120" />
                                                    <input type="radio" name="tree" value="phyla5" id="cellPopPhyla5" />
                                                    <label for="cellPopPhyla5">Phyla5</label>
                                                </div>
                                                <div class="col">
                                                    <img src="phyla3.png" height="120" />
                                                    <input type="radio" name="tree" value="phyla3" id="cellPopPhyla3"
                                                        checked />
                                                    <label for="cellPopPhyla3">Phyla3</label>
                                                </div>
                                                <div class="col">
                                                    <img src="phyla1.png" height="120" />
                                                    <input type="radio" name="tree" value="phyla1" id="cellPopPhyla1" />
                                                    <label for="cellPopPhyla1">Phyla1</label>
                                                </div>
                                            </div>
                                            <div class="input-group input-group-sm mt-2">
                                                <span class="input-group-text">
                                                    <input type="radio" name="tree" value="custom" id="cellPopCustom" />
                                                    <label for="cellPopCustom" class="ms-1">Custom tree</label>
                                                </span>
                                                <input name="_treeCustom" type="customTree" class="form-control"
                                                    placeholder="rtree(4)" value="rtree(4)" data-v="n">
                                            </div>
                                            <div class="border rounded text-small mt-2 p-2">
                                                <div class="text-secondary text-small fw-bold mb-1">Preview</div>
                                                <div id="tree_summary"></div>
                                                <div id="tree_plot" class="shiny-plot-output m-2" style="height: 120px">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="input-group input-group-sm mt-2">
                                            <div class="input-group-text">
                                                <input class="form-check-input mt-0" type="checkbox" name="use.impulse"
                                                    value="" />
                                            </div>
                                            <span class="input-group-text"> Use an alternative impulse model to sample
                                                along the tree </span>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="pane-pop-disc" role="tabpanel" tabindex="0">
                                        <div class="text-secondary text-small p-2">
                                            For discrete population, the cells will be sampled from the leaves of the
                                            cell differential tree. This GUI will
                                            generate a corresponding tree according to the number of clusters you
                                            specified.
                                        </div>
                                        <div class="input-group mb-2">
                                            <span class="input-group-text"> Num. Clusters </span>
                                            <input name="_numCluster" class="form-control" placeholder="5" value="5"
                                                data-v="i:1-10000" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="border rounded p-2">
                                            <div class="input-group input-group-sm mb-2">
                                                <span class="input-group-text"> Smallest Cluster Size </span>
                                                <input name="discrete.min.pop.size" class="form-control"
                                                    placeholder="70" value="70" data-v="i:1-10000000" />
                                                <div class="invalid-feedback"></div>
                                            </div>
                                            <div class="text-secondary text-small my-2">
                                                Let scMultiSim decide the cluster sizes, but one cluster will be small
                                                and will have this many cells, which
                                                represents a rare cell type.
                                            </div>
                                            <div class="input-group input-group-sm my-2">
                                                <span class="input-group-text"> Cluster Size </span>
                                                <input name="discretePopSize" class="form-control"
                                                    placeholder="100,100,100,100" value="" data-v="c">
                                                <div class="invalid-feedback"></div>
                                            </div>
                                            <div class="text-secondary text-small mt-2">
                                                Overrides "Smallest Cluster Size". Specify the size of each cluster
                                                manually, e.g. "100,100,200,100" for 500 cells
                                                and 4 clusters. The number of clusters should match the provided tree,
                                                and the total number of cells should match
                                                the specified number of cells.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- end: Population Type-->
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Genes</div>
                            <div class="card-body">
                                <ul class="nav nav-pills" id="grnTab" role="tablist" style="display: none">
                                    <button class="nav-link active" id="grn-enable-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-grn-on" type="button" role="tab">
                                        Enabled
                                    </button>
                                    <button class="nav-link" id="grn-disable-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-grn-off" type="button" role="tab">
                                        Disabled
                                    </button>
                                </ul>
                                <!-- GRN -->
                                <div class="input-group">
                                    <span class="input-group-text">GRN</span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="_grnEnabled" value="on"
                                            id="grnEnabled1" checked />
                                        <label class="form-check-label ms-1" for="grnEnabled1"> Enabled </label>
                                    </span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="_grnEnabled" value="off"
                                            id="grnEnabled2" />
                                        <label class="form-check-label ms-1" for="grnEnabled2"> Disabled </label>
                                    </span>
                                </div>
                                <div class="tab-content">
                                    <div class="tab-pane active pt-2" id="pane-grn-on" role="tabpanel" tabindex="0">
                                        <div class="border rounded mt-2 p-2">
                                            <div class="mb-2">
                                                <span class="legend-rect" style="background: rgb(226, 226, 226)"></span>
                                                GRN Data
                                            </div>
                                            <div class="input-group mb-1">
                                                <span class="input-group-text">GRN Dataframe</span>
                                                <input name="GRN" type="text" class="form-control"
                                                    placeholder="GRN_params_100" value="GRN_params_100" data-v="n">
                                                <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                                    data-bs-toggle="dropdown">
                                                    Select R object
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-end" id="R_grnSelect"></ul>
                                            </div>
                                            <div class="border rounded text-small p-2">
                                                <div class="text-secondary text-small fw-bold mb-1">Preview</div>
                                                <div id="grn_summary" class="shiny-text-output"></div>
                                                <div id="grn_head" class="shiny-html-output"></div>
                                            </div>
                                            <div class="text-secondary text-small p-2">
                                                Specify an existing R dataframe here. The dataframe should have three
                                                columns: target, regulator, and effect.
                                                target and regulator can be an integer representing the gene ID
                                                (recommended), or a string representing the gene
                                                name.
                                            </div>
                                        </div>
                                        <div class="input-group mt-2">
                                            <span class="input-group-text">Num. Genes</span>
                                            <input name="num.genes" type="number" class="form-control" placeholder="500"
                                                value="120" data-v="i:1-1000000" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2 mb-1">
                                            Total number of genes. Should be larger than the genes in the GRN.
                                            Additional genes are sequentially named (e.g.
                                            "gene_1") and will be randomly sampled.
                                        </div>
                                    </div>
                                    <div class="tab-pane pt-2" id="pane-grn-off" role="tabpanel" tabindex="0">
                                        <div class="input-group">
                                            <span class="input-group-text">Num. Genes</span>
                                            <input name="num.genes2" type="number" class="form-control"
                                                placeholder="500" value="500" data-v="i:1-1000000" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2 mb-1">Gene Regulatory Network (GRN) is
                                            disabled.</div>
                                    </div>
                                </div>
                                <!-- end: GRN -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane pt-2" id="pane-atac" role="tabpanel" tabindex="0">
                <div class="accordion mt-2 mb-3" id="accordionATACHelp">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseATACHelp">
                                Summary: Chromatin Accessibility
                            </button>
                        </h2>
                        <div id="collapseATACHelp" class="accordion-collapse collapse show"
                            data-bs-parent="#accordionATACHelp">
                            <div class="alert alert-secondary mt-2 mx-2 mb-0" role="alert">
                                In scMultiSim, the number of regions (peaks) we simulate is 3 times the number of genes.
                                First, each chromatin region has
                                a latent <b>Region Identity Vector (RIV)</b> that is sampled from a zero-inflated
                                Gaussian distribution. The chromatin
                                accessibility data is generated based on the product of CIF and RIV matrix. scMultiSim
                                connects chromatin accessibility to
                                gene expression through the <b>k_on</b>
                                Kinetic parameter.
                            </div>
                            <div class="accordion-body">
                                <div id="atac-svg-container" class="mx-auto" style="width: 960px"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Chromatin Regions</div>
                            <div class="card-body">
                                <h6 class="my-2">
                                    <span class="legend-rect" style="background: #ffe5d0"></span>
                                    Region Identity Vectors (RIV) Distribution
                                </h6>
                                <div class="input-group">
                                    <span class="input-group-text">μ</span>
                                    <input name="riv.mean" type="number" class="form-control" placeholder="0" value="0"
                                        data-v="f:0-1000" />
                                    <span class="input-group-text">σ</span>
                                    <input name="riv.sd" type="number" class="form-control" placeholder="1" value="1"
                                        data-v="f:0-1000" />
                                    <span class="input-group-text">p</span>
                                    <input name="riv.prob" type="number" class="form-control" placeholder="0.3"
                                        value="0.3" data-v="f:0-1" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small px-2 pt-2">
                                    The values in RIV will be sampled from this distribution: With prob. p, the value is
                                    zero; with prob. 1-p, the value is
                                    sampled from a Gaussian distribution N(μ,σ).
                                </div>
                                <h6 class="my-2">
                                    <span class="legend-rect" style="background: #d2f4ea"></span>
                                    Gene-Region Relationship
                                </h6>
                                <div class="input-group">
                                    <span class="input-group-text">Region Distribution</span>
                                    <input name="_regionDist0" type="number" class="form-control" placeholder="0.1"
                                        value="0.1" data-v="c" />
                                    <input name="_regionDist1" type="number" class="form-control" placeholder="0.5"
                                        value="0.5" data-v="c" />
                                    <input name="_regionDist2" type="number" class="form-control" placeholder="0.4"
                                        value="0.4" data-v="c" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    How many genes are associated with 0, 1, or 2 consecutive chromatin regions,
                                    respectively. Should sum up to 1.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">ATAC Data</div>
                            <div class="card-body">
                                <h6 class="my-2">
                                    <span class="legend-rect" style="background: #f7d6e6"></span>
                                    ATAC Effect
                                </h6>
                                <div class="input-group">
                                    <span class="input-group-text">ATAC Effect</span>
                                    <input name="atac.effect" type="number" class="form-control" placeholder="0.5"
                                        value="0.5" data-v="f:0-1" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    How strong the chromatin accessibility is associated with the gene expression (0-1).
                                </div>
                                <h6 class="my-2">
                                    <span class="legend-rect" style="background: #cff4fc"></span>
                                    scATAC-seq Data Distribution
                                </h6>
                                <div class="input-group">
                                    <span class="input-group-text">ATAC Prob. Zero</span>
                                    <input name="atac.p_zero" type="number" class="form-control" placeholder="0.8"
                                        value="0.8" data-v="f:0-1" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">The proportion of zeros we see in the
                                    ATAC-seq data.</div>
                                <div class="input-group mb-1">
                                    <div class="input-group-text">
                                        <input class="form-check-input mt-0" type="checkbox" name="useCustomATACDensity"
                                            value="" id="useCustomATACDensity" />
                                        <label class="ms-2" for="useCustomATACDensity">Use custom density
                                            distribution</label>
                                    </div>
                                </div>
                                <div class="input-group mb-3">
                                    <span class="input-group-text">Custom Density</span>
                                    <input name="atac.density" type="text" class="form-control" placeholder="my_dens"
                                        value="" data-v="n">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown">
                                        Select R object
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" id="R_densSelect"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane pt-2" id="pane-sim" role="tabpanel" tabindex="0">
                <div class="row">
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">General Settings</div>
                            <div class="card-body">
                                <div class="input-group mb-2">
                                    <span class="input-group-text">Random Seed</span>
                                    <input name="seed" type="number" class="form-control" placeholder="1" value="1"
                                        data-v="i">
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">Speed Optimization (Experimental)</span>
                                    <span class="input-group-text">
                                        <input class="form-check-input mt-0" type="checkbox" name="speed.up" value="" />
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="card border-dark mb-3">
                            <div class="card-header">Parameter Adjustment</div>
                            <div class="card-body">
                                <div class="input-group">
                                    <span class="input-group-text">Scale `s`</span>
                                    <input name="scale.s" type="text" class="form-control" placeholder="1" value="1"
                                        data-v="f:1-1000">
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    Scale the `s` kinetic parameter to increase or decrease the overall gene expression.
                                    When using discrete population, it
                                    can be multiple numbers specifying the scale for each cluster, e.g. "1,2,1,1".
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">Bimodality</span>
                                    <input name="bimod" type="number" class="form-control" placeholder="0" value="0"
                                        data-v="f:0-1" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    Adjust the bimodality of gene expression, thus controlling intrinsic variation
                                    (0-1).
                                </div>
                                <div class="alert alert-info" role="alert">
                                    <div class="fw-bold d-flex align-items-center">
                                        <svg class="bi flex-shrink-0 me-2" role="img" aria-label="Info:">
                                            <use xlink:href="#info-fill" />
                                        </svg>
                                        <div>Even more flexibility</div>
                                    </div>
                                    <div>
                                        You can adjust the CIF and GIV values programmatically by passing a function to
                                        the `mod.cif.giv` option in the code.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Kinetic Model</div>
                            <div class="card-body">
                                <ul class="nav nav-pills" id="veloTab" role="tablist" style="display: none">
                                    <button class="nav-link" id="velo-enable-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-velo-on" type="button" role="tab">
                                        Enabled
                                    </button>
                                    <button class="nav-link active" id="velo-disable-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-velo-off" type="button" role="tab">
                                        Disabled
                                    </button>
                                </ul>
                                <!-- Velocity -->
                                <div class="input-group">
                                    <span class="input-group-text">RNA Velocity Simulation</span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="velocity" value="on"
                                            id="veloEnabled1" />
                                        <label class="form-check-label ms-1" for="veloEnabled1"> Enabled </label>
                                    </span>
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="radio" name="velocity" value="off"
                                            id="veloEnabled2" checked />
                                        <label class="form-check-label ms-1" for="veloEnabled2"> Disabled </label>
                                    </span>
                                </div>
                                <div class="tab-content">
                                    <div class="tab-pane pt-2" id="pane-velo-on" role="tabpanel" tabindex="0">
                                        <div class="input-group">
                                            <span class="input-group-text">β</span>
                                            <input name="beta" type="number" class="form-control" placeholder="0.4"
                                                value="0.4" data-v="f:0-100" />
                                            <div class="invalid-feedback"></div>
                                            <span class="input-group-text">d</span>
                                            <input name="d" type="number" class="form-control" placeholder="1" value="1"
                                                data-v="f:0-100" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2">
                                            β is the splicing rate of each gene in the kinetic model, while d is the
                                            degradation rate.
                                        </div>
                                        <div class="input-group">
                                            <span class="input-group-text">Num. Cycles</span>
                                            <input name="num.cycles" type="number" class="form-control"
                                                placeholder="0.4" value="3" data-v="i:1-100" />
                                            <div class="invalid-feedback"></div>
                                            <span class="input-group-text">Cycle Length</span>
                                            <input name="cycle.len" type="number" class="form-control" placeholder="1"
                                                value="1" data-v="f:0-100" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2">Cell cycles when running the kinetic
                                            model.</div>
                                    </div>
                                    <div class="tab-pane active pt-2" id="pane-velo-off" role="tabpanel" tabindex="0">
                                        <div class="text-secondary text-small p-2">RNA counts will be sampled from the
                                            Beta-Poisson distribution.</div>
                                        <div class="input-group">
                                            <span class="input-group-text">Intrinsic Noise</span>
                                            <input name="intrinsic.noise" type="number" class="form-control"
                                                placeholder="1" value="1" data-v="f:0-1" />
                                            <div class="invalid-feedback"></div>
                                        </div>
                                        <div class="text-secondary text-small p-2">
                                            The weight assigned to the random sample from the Beta-Poisson distribution.
                                            When smaller than 1, the RNA counts
                                            will also contain the Beta-Poisson mean value (less noisy) with weight (1 -
                                            intrinsic.noise).
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="pane-spatial" role="tabpanel" tabindex="0">
                <div class="row pt-3">
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-body">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <input class="form-check-input" type="checkbox" name="_spatialEnabled" value=""
                                            id="spatialEnabled" />
                                    </span>
                                    <span class="input-group-text">
                                        <label for="spatialEnabled">Enable simulating spatial
                                            data</label>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row pt-2">
                    <div class="col-7">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Layout Preview</div>
                            <div class="card-body">
                                <div class="d-flex">
                                    <button class="btn btn-primary" id="submit_spatial">Generate Preview</button>
                                    <div class="text-secondary p-2" id="submit_spatial_msg"></div>
                                </div>
                                <div id="spatial-svg-container" class="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-dark mb-3">
                            <div class="card-header">Layout</div>
                            <div class="card-body">
                                <ul class="nav nav-pills" id="spLayoutTab" role="tablist" style="display: none">
                                    <button class="nav-link active" id="sp-normal-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-sp-normal" type="button" role="tab">
                                        Normal
                                    </button>
                                    <button class="nav-link" id="sp-layers-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-sp-layers" type="button" role="tab">
                                        Layers
                                    </button>
                                    <button class="nav-link" id="sp-islands-tab" data-bs-toggle="tab"
                                        data-bs-target="#pane-sp-islands" type="button" role="tab">
                                        Islands
                                    </button>
                                </ul>
                                <div class="input-group">
                                    <span class="input-group-text">Grid Size</span>
                                    <input name="sp.grid.size" type="number" class="form-control" placeholder="40"
                                        value="40" data-v="i:10-1000" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    The grid width and height of the spatial layout. Should be large enough to fit all
                                    cells.
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">Step Size</span>
                                    <input name="sp.step.size" type="number" class="form-control" placeholder="0.5"
                                        value="0.5" data-v="f:0-100" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    If using continuous population, use this step size to further divide the
                                    cell types on the tree. For example, if the tree only has one branch 1 -> 2
                                    and the branch length is 1 while the step size is 0.34, there will be totally
                                    three cell types: 1_2_1, 1_2_2, 1_2_3.
                                </div>
                                <h6 class="my-2">
                                    Spatial Layout
                                </h6>
                                <div class="border rounded p-2">
                                    <div class="input-group">
                                        <span class="input-group-text">Layout Type</span>
                                        <select name="_spLayout" class="form-select" data-v="n">
                                            <option value="normal">Normal</option>
                                            <option value="islands">Islands</option>
                                            <option value="layers">Layers</option>
                                        </select>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane pt-2 active" id="pane-sp-normal" role="tabpanel"
                                            tabindex="0">
                                            <div class="input-group">
                                                <span class="input-group-text">Same Type Prob.</span>
                                                <input name="sp.same.type.prob" type="number" class="form-control"
                                                    placeholder="0.8" value="0.8" data-v="f:0-1" />
                                                <div class="invalid-feedback"></div>
                                            </div>
                                            <div class="text-secondary text-small p-2">
                                                When placing a new cell, the probability of placing it next to a cell of
                                                the same type.
                                            </div>
                                        </div>
                                        <div class="tab-pane pt-2" id="pane-sp-layers" role="tabpanel" tabindex="0">
                                        </div>
                                        <div class="tab-pane pt-2" id="pane-sp-islands" role="tabpanel" tabindex="0">
                                            <div class="input-group">
                                                <span class="input-group-text">Island Cell Types</span>
                                                <input name="_spIslands" type="number" class="form-control"
                                                    placeholder="1,2" value="1" data-v="n" />
                                                <div class="invalid-feedback"></div>
                                            </div>
                                            <div class="text-secondary text-small p-2">
                                                The cell types in the islands. Should be a comma-separated list.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card border-dark mb-3">
                            <div class="card-header">Cell-Cell Interaction</div>
                            <div class="card-body">
                                <div class="input-group">
                                    <span class="input-group-text">Max Num. Neighbors</span>
                                    <input name="sp.max.neighbors" type="number" class="form-control" placeholder="4"
                                        value="4" data-v="i:1-4" />
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    Max number of neighbors a cell will interact with.
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text">CCI Dataframe</span>
                                    <input name="_CCI" type="text" class="form-control" placeholder="cci_params"
                                        value="" data-v="n">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown">
                                        Select R object
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" id="R_cciSelect"></ul>
                                </div>
                                <div class="text-secondary text-small p-2">
                                    Specify an existing R dataframe here. The dataframe should have three columns:
                                    target, regulator, and effect. target and regulator can be an integer representing
                                    the gene.
                                    effect is the strength of the interaction.
                                    For example:
                                    <pre class="p-0">
data.frame(
    target    = c(101, 102),
    regulator = c(103, 104),
    effect    = c(5.2, 5.9)
)
                                    </pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="pane-recipes" role="tabpanel" tabindex="0">
                <div class="alert alert-info my-3" role="alert">
                    <div class="fw-bold d-flex align-items-center">
                        <svg class="bi flex-shrink-0 me-2" role="img" aria-label="Info:">
                            <use xlink:href="#info-fill" />
                        </svg>
                        <div>Recipes</div>
                    </div>
                    <div>
                        Pre-defined recipes for generating the simulation parameters.
                        Enabling these recipes will overwrite some of the parameters you have set.
                    </div>
                </div>
                <div class="card border-dark my-3">
                    <div class="card-body">
                        <input class="form-check-input me-2" type="radio" name="_recipe" value="none" id="recipe0"
                            checked />
                        <label class="form-check-label" for="recipe0">None</label>
                    </div>
                </div>
                <div class="card border-dark my-3">
                    <div class="card-header">
                        <input class="form-check-input me-2" type="radio" name="_recipe" value="multicond"
                            id="recipe1" />
                        <label class="form-check-label" for="recipe1">Multiple Conditions</label>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            Simulates two conditions by modifying some CIF entries using the <code>mod.cif.giv</code>
                            option. It will output two option sets, <code>params1</code> and <code>params2</code>.
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">Num. CIF to Change</span>
                            <input name="_recipe1_numCIF" type="number" class="form-control" placeholder="4" value="4"
                                data-v="i:1-100" />
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="text-secondary text-small p-2">
                            How many CIF entries to change for each cell. The CIF entries will be randomly selected.
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">Noise Strength</span>
                            <input name="_recipe1_noise" type="number" class="form-control" placeholder="3" value="3"
                                data-v="f:0-100" />
                        </div>
                        <div class="text-secondary text-small p-2">
                            How much noise to add to the selected CIF entries. The noise will be sampled from a Gaussian
                            distribution.
                        </div>
                    </div>
                </div>
                <div class="card border-dark my-3">
                    <div class="card-header">
                        <input class="form-check me-2" type="radio" name="_recipe" value="spdomain" id="recipe2" />
                        <label class="form-check-label" for="recipe2">Spatial Domain</label>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            Simulates spatial domains by defining
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">Num. CIF to Change</span>
                            <input name="_recipe2_numCIF" type="number" class="form-control" placeholder="4" value="4"
                                data-v="i:1-100" />
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="text-secondary text-small p-2">
                            How many CIF entries to change for each cell. The CIF entries will be randomly selected.
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">Noise Strength</span>
                            <input name="_recipe2_noise" type="number" class="form-control" placeholder="3" value="3"
                                data-v="f:0-100" />
                        </div>
                        <div class="text-secondary text-small p-2">
                            How much noise to add to the selected CIF entries. The noise will be sampled from a Gaussian
                            distribution.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="modal fade" id="usageModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">scMultiSim Shiny App Usage</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-secondary">
                        Welcome to the scMultiSim Shiny App!
                        As a powerful de novo simulation tool,
                        scMultiSim provides numerous options to generate single-cell datasets with various biological
                        effects.
                        This app is designed to help you decide simulation parameters and output them to an R object,
                        which can therefore be used to run the simulation.
                    </p>
                    <p>
                        To get started, simply navigate through the tabs on the top and set the parameters as needed.
                        Each tab corresponds to a specific aspect of the simulation.
                    </p>
                    <p>
                        When finished setting the parameters,
                        simply click the <b>"Output Parameters" button</b> to write the options to an R object named
                        <code>opt</code>.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" tabindex="-1" id="outputModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Options written to R</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        The parameters has been written into the R object <code>opt</code>.
                    </p>
                    <div class="alert alert-info" role="alert">
                        Need to change the options or add more custom options?
                        You can modify the <code>opt</code> object directly:
                        <pre class="my-2">opt$cif.sigma = 0.8</pre>
                    </div>
                    <div class="alert alert-info" role="alert">
                        Ready to run the simulation?
                        Close this Shiny App and run the following code in R:
                        <pre class="mt-2 mb-3">res <- sim_true_counts(opt)</pre>
                        <button type="button" class="btn btn-danger btn-sm" id="stopApp">Stop this Shiny App</button>
                    </div>
                    <div class="alert alert-dark" role="alert">
                        Need to go back and change some options?
                        Simply close this dialog and make the changes.
                        The <code>opt</code> object will be updated next time you click the "Output Parameters" button.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="options.js"></script>
    <script src="validate.js"></script>
    <script src="output.js"></script>
</body>

</html>